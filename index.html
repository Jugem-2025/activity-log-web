
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ê¥ªÂãïË®òÈå≤</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      max-width: 800px;
      margin: auto;
      background: #f5f6fa;
      color: #333;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #4a90e2;
      color: white;
      padding: 12px 16px;
      border-radius: 8px;
    }
    header h1 {
      font-size: 1.4em;
      margin: 0;
    }
    .top-icons a {
      margin-left: 10px;
      color: white;
      font-size: 1.4em;
      text-decoration: none;
    }
    .date-picker {
      display: block;
      margin: 16px 0;
      font-size: 1em;
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .hour-block {
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      margin-bottom: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .hour-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: #f0f4f8;
      border-bottom: 1px solid #ddd;
      cursor: pointer;
    }
    .compact {
      display: none;
      padding: 10px 12px;
      font-size: 0.95em;
      color: #555;
    }
    .hour-content {
      padding: 10px 12px;
    }
    .hour-content.hidden {
      display: none;
    }
    .checkbox-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }
    .tag-item {
      display: flex;
      align-items: center;
      background: #e8f0fe;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.95em;
      cursor: pointer;
    }
    .tag-item input[type="checkbox"] {
      margin-right: 4px;
      pointer-events: auto;
    }
    .flex-row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
    }
    .flex-row label {
      font-weight: bold;
      white-space: nowrap;
    }
    .flex-row select,
    .flex-row input[type="text"] {
      padding: 6px;
      font-size: 0.95em;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .save-btn {
      background: #4a90e2;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
    }
    .save-btn:hover {
      background: #3b78c5;
    }
    .daily-note {
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .daily-note label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
    }
    .daily-note input[type="checkbox"] {
      margin-right: 6px;
    }
    .daily-note textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical;
    }
  </style>
</head>
<body>
  <header>
    <h1>Ê¥ªÂãïË®òÈå≤</h1>
    <div class="top-icons">
      <a href="weekly.html" title="ÈÄ±ÈñìË°®Á§∫">üìÖ</a>
      <a href="tags.html" title="„Çø„Ç∞Á∑®ÈõÜ">‚öôÔ∏è</a>
    </div>
  </header>
  <input type="date" id="recordDate" class="date-picker" />
  <div id="recordArea"></div>
  <div class="daily-note">
    <label><input type="checkbox" id="alcohol"> „Ç¢„É´„Ç≥„Éº„É´</label>
    <label><input type="checkbox" id="caffeine"> „Ç´„Éï„Çß„Ç§„É≥</label>
    <label>„É°„É¢„ÉªÂÇôËÄÉÔºö</label>
    <textarea id="dailyMemo" rows="3" placeholder="Ëá™Áî±Ë®òÂÖ•"></textarea>
  </div>
  <script>
    const defaultTags = ["Ëµ∑Â∫ä","„Ç∑„É£„ÉØ„Éº„ÉªÈ¢®ÂëÇ","ÊúùÈ£ü","ÊòºÈ£ü","Â§ïÈ£ü","Â§ñÂá∫","ÁßªÂãï","ÂÄã‰∫∫Ë™≤È°å","Ë¨õÁæ©","Â∏∞ÂÆÖ","ÂÆ∂‰∫ã","‰ºëÊÜ©","Â∞±ÂØù","Ëñ¨","Áù°Áú†"];
    const tags = JSON.parse(localStorage.getItem("tags")) || defaultTags;
    const moods = Array.from({ length: 21 }, (_, i) => i * 5);
    const recordArea = document.getElementById('recordArea');

    function render() {
      const dateStr = document.getElementById('recordDate').value;
      const data = JSON.parse(localStorage.getItem(dateStr) || '{}');
      recordArea.innerHTML = '';

      const alcoholChk = document.getElementById("alcohol");
      const caffeineChk = document.getElementById("caffeine");
      const dailyMemo = document.getElementById("dailyMemo");

      if (data.dailyNote) {
        alcoholChk.checked = data.dailyNote.alcohol;
        caffeineChk.checked = data.dailyNote.caffeine;
        dailyMemo.value = data.dailyNote.memo;
      }

      for (let i = 0; i < 24; i++) {
        const hour = (i + 4) % 24;
        const key = hour.toString().padStart(2, '0');
        const entry = data[key] || { activity: [], mood: 50, fatigue: 50, free: '', folded: false };

        const block = document.createElement('div');
        block.className = 'hour-block';

        const header = document.createElement('div');
        header.className = 'hour-header';

        const label = document.createElement('div');
        label.textContent = `${key}:00`;

        const btn = document.createElement('button');
        btn.className = 'save-btn';
        btn.textContent = '‰øùÂ≠ò„Åô„Çã';

        const compact = document.createElement('div');
        compact.className = 'compact';
        compact.innerHTML = `
          <strong>„ÇÑ„Å£„Åü„Åì„Å®:</strong> ${entry.activity.join(', ') || '‚Äï'}<br>
          <strong>Ê∞óÂàÜ:</strong> ${entry.mood}„ÄÄ<strong>Áñ≤Âä¥:</strong> ${entry.fatigue}<br>
          <strong>„É°„É¢:</strong> ${entry.free || '‚Äï'}
        `;

        const content = document.createElement('div');
        content.className = entry.folded ? 'hour-content hidden' : 'hour-content';

        const ckGrid = document.createElement('div');
        ckGrid.className = 'checkbox-grid';

        tags.forEach(tag => {
          const tagItem = document.createElement('div');
          tagItem.className = 'tag-item';

          const chk = document.createElement('input');
          chk.type = 'checkbox';
          chk.value = tag;
          chk.checked = entry.activity.includes(tag);

          chk.addEventListener('change', () => {
            if (chk.checked) {
              if (tag === "Áù°Áú†") {
                entry.activity = ["Áù°Áú†"];
                entry.mood = '';
                entry.fatigue = '';
              } else {
                entry.activity = entry.activity.filter(t => t !== "Áù°Áú†" && t !== tag);
                entry.activity.push(tag);
              }
            } else {
              entry.activity = entry.activity.filter(t => t !== tag);
            }
          });

          tagItem.appendChild(chk);
          tagItem.appendChild(document.createTextNode(tag));
          ckGrid.appendChild(tagItem);
        });

        const freeTxt = document.createElement('input');
        freeTxt.type = 'text';
        freeTxt.placeholder = 'Ëá™Áî±Ë®òÂÖ•';
        freeTxt.value = entry.free;

        const row = document.createElement('div');
        row.className = 'flex-row';

        const moodLabel = document.createElement('label');
        moodLabel.textContent = "Ê∞óÂàÜ:";
        const selMood = document.createElement('select');
        moods.forEach(m => {
          const o = document.createElement('option');
          o.value = o.textContent = m;
          if (m === entry.mood) o.selected = true;
          selMood.appendChild(o);
        });

        const fatigueLabel = document.createElement('label');
        fatigueLabel.textContent = "Áñ≤Âä¥Â∫¶:";
        const selFat = document.createElement('select');
        moods.forEach(f => {
          const o = document.createElement('option');
          o.value = o.textContent = f;
          if (f === entry.fatigue) o.selected = true;
          selFat.appendChild(o);
        });

        row.append(moodLabel, selMood, fatigueLabel, selFat);
        content.append(ckGrid, freeTxt, row, btn);
        header.append(label, btn);
        block.append(header, compact, content);
        recordArea.append(block);

        header.onclick = () => {
          entry.folded = !entry.folded;
          data[key] = entry;
          localStorage.setItem(dateStr, JSON.stringify(data));
          render();
        };

        btn.onclick = () => {
          entry.mood = entry.activity.includes("Áù°Áú†") ? '' : parseInt(selMood.value);
          entry.fatigue = entry.activity.includes("Áù°Áú†") ? '' : parseInt(selFat.value);
          entry.free = freeTxt.value;
          entry.folded = true;
          data[key] = entry;
          data.dailyNote = {
            alcohol: alcoholChk.checked,
            caffeine: caffeineChk.checked,
            memo: dailyMemo.value
          };
          localStorage.setItem(dateStr, JSON.stringify(data));
          render();
        };

        compact.style.display = entry.folded ? 'block' : 'none';
      }
    }

    const dp = document.getElementById("recordDate");
    dp.value = new Date().toISOString().split("T")[0];
    dp.onchange = render;
    render();
  </script>
</body>
</html>
